<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yorutsuke v2 - æ¨¡å—æ¶æ„å…¨æ™¯å›¾</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            text-align: center;
            margin-bottom: 60px;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.2em;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        .version {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
        }

        section {
            background: white;
            margin-bottom: 40px;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        section h2 {
            font-size: 2em;
            color: #2c3e50;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #3498db;
        }

        section h3 {
            font-size: 1.5em;
            color: #34495e;
            margin-top: 30px;
            margin-bottom: 20px;
        }

        .diagram {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid #ecf0f1;
            overflow-x: auto;
        }

        .layer-diagram {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 30px 0;
        }

        .layer {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            border-left: 4px solid #f39c12;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .layer.l4 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .layer.l3 {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .layer.l2 {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .layer.l1 {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .layer-title {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .layer-description {
            font-size: 0.95em;
            opacity: 0.95;
            margin-bottom: 15px;
        }

        .layer-modules {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .module-tag {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .module-card {
            background: linear-gradient(135deg, #ffffff 0%, #f5f7fa 100%);
            border: 2px solid #e8eef5;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            border-color: #3498db;
        }

        .module-name {
            font-size: 1.2em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .module-tier {
            display: inline-block;
            background: #ecf0f1;
            color: #7f8c8d;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .module-desc {
            font-size: 0.9em;
            color: #7f8c8d;
            line-height: 1.5;
        }

        .data-flow {
            background: #f8f9fa;
            padding: 30px;
            border-left: 4px solid #3498db;
            border-radius: 8px;
            margin: 30px 0;
        }

        .flow-step {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 3px solid #3498db;
        }

        .flow-step-num {
            background: #3498db;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .flow-step-content {
            flex: 1;
        }

        .flow-step-title {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .flow-step-desc {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        th {
            background: #ecf0f1;
            font-weight: 700;
            color: #2c3e50;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .color-kernel {
            color: #e74c3c;
            font-weight: 600;
        }

        .color-domain {
            color: #f39c12;
            font-weight: 600;
        }

        .color-module {
            color: #27ae60;
            font-weight: 600;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .arrow {
            color: #7f8c8d;
            font-size: 1.2em;
            margin: 0 10px;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .highlight {
            background: #fff3cd;
            padding: 20px;
            border-left: 4px solid #ffc107;
            border-radius: 8px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            section h2 {
                font-size: 1.5em;
            }

            .layer-modules {
                flex-direction: column;
            }

            .module-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>ğŸ—ï¸ Yorutsuke v2 æ¶æ„å…¨æ™¯å›¾</h1>
            <p class="subtitle">ä»åº•å±‚åˆ°é¡¶å±‚çš„æ¨¡å—åˆ†å±‚è®¾è®¡</p>
            <div class="version">ç‰ˆæœ¬: v2 Local-First + Cloud-Sync</div>
        </header>

        <!-- åˆ†å±‚æ¶æ„æ€»è§ˆ -->
        <section>
            <h2>ğŸ“Š åˆ†å±‚æ¶æ„æ€»è§ˆ</h2>
            
            <div class="highlight">
                <strong>æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼š</strong> Service æŒ‡æŒ¥ | Tauri æ‰§è¡Œ | AWS å®¡è®¡ | React å±•ç¤º
            </div>

            <div class="layer-diagram">
                <!-- Layer 4: React View -->
                <div class="layer l1">
                    <div class="layer-title">ğŸ¨ Layer 4: React View (UIå±•ç¤ºå±‚)</div>
                    <div class="layer-description">
                        è´Ÿè´£ç”¨æˆ·ç•Œé¢æ¸²æŸ“å’Œäº¤äº’å“åº”ï¼Œè®¢é˜… Zustand Store è·å–å®æ—¶çŠ¶æ€ï¼Œé€šè¿‡äº‹ä»¶æ€»çº¿æ¥æ”¶ä¸€æ¬¡æ€§é€šçŸ¥ã€‚
                    </div>
                    <div class="layer-modules">
                        <span class="module-tag">ç»„ä»¶ Components</span>
                        <span class="module-tag">é¡µé¢ Pages</span>
                        <span class="module-tag">æ ·å¼ Styles</span>
                        <span class="module-tag">Hooks (ä»…UI)</span>
                    </div>
                </div>

                <!-- Layer 3: Pure TS Services -->
                <div class="layer l2">
                    <div class="layer-title">âš™ï¸ Layer 3: Pure TS Services (ä¸šåŠ¡ç¼–æ’å±‚)</div>
                    <div class="layer-description">
                        ä¸šåŠ¡æµç¨‹ç¼–æ’ã€å…¨å±€çŠ¶æ€ç®¡ç†ã€å…¨å±€äº‹ä»¶ç›‘å¬ã€‚ç‹¬ç«‹äºReactç”Ÿå‘½å‘¨æœŸï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–ä¸€æ¬¡ã€‚
                    </div>
                    <div class="layer-modules">
                        <span class="module-tag">Service Classes</span>
                        <span class="module-tag">Zustand Stores</span>
                        <span class="module-tag">Event Listeners</span>
                        <span class="module-tag">Business Logic</span>
                    </div>
                </div>

                <!-- Layer 2: Adapters -->
                <div class="layer l3">
                    <div class="layer-title">ğŸŒ‰ Layer 2: Adapters (æ¥å£é€‚é…å±‚)</div>
                    <div class="layer-description">
                        Tauri IPC å’Œ AWS API çš„ç»Ÿä¸€å°è£…ã€‚å±è”½åº•å±‚å®ç°ç»†èŠ‚ï¼Œæä¾›ä¸€è‡´çš„æ¥å£ã€‚
                    </div>
                    <div class="layer-modules">
                        <span class="module-tag">Tauri IPC</span>
                        <span class="module-tag">AWS SDK</span>
                        <span class="module-tag">Error Handling</span>
                    </div>
                </div>

                <!-- Layer 1: Executors -->
                <div class="layer l4">
                    <div class="layer-title">âš¡ Layer 1: Executors (æ‰§è¡Œå±‚)</div>
                    <div class="layer-description">
                        ç³»ç»Ÿèƒ½åŠ›æ‰§è¡Œã€é«˜æ€§èƒ½è®¡ç®—ã€äº‘ç«¯æ•°æ®æŒä¹…åŒ–å’Œæƒé™éªŒè¯ã€‚
                    </div>
                    <div class="layer-modules">
                        <span class="module-tag">Tauri (Native)</span>
                        <span class="module-tag">AWS Lambda</span>
                        <span class="module-tag">DynamoDB</span>
                        <span class="module-tag">Cognito Auth</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Kernel å±‚ -->
        <section>
            <h2>ğŸ”§ Layer 0: Kernel (å†…æ ¸åŸºç¡€å±‚)</h2>
            
            <p>æ•´ä¸ªç³»ç»Ÿçš„åŸºç¡€è®¾æ–½å±‚ï¼Œæ‰€æœ‰å…¶ä»–å±‚éƒ½ä¾èµ–å®ƒã€‚</p>

            <div class="module-grid">
                <div class="module-card">
                    <div class="module-name">00_kernel/config</div>
                    <div class="module-tier">åŸºç¡€é…ç½®</div>
                    <div class="module-desc">
                        åº”ç”¨å…¨å±€é…ç½®ã€Mock æ¨¡å¼åˆ‡æ¢ã€ç‰¹æ€§æ ‡å¿—ç®¡ç†ã€‚
                    </div>
                </div>

                <div class="module-card">
                    <div class="module-name">00_kernel/storage</div>
                    <div class="module-tier">æœ¬åœ°å­˜å‚¨</div>
                    <div class="module-desc">
                        SQLite æ•°æ®åº“æ“ä½œã€äº‹åŠ¡ç®¡ç†ã€æœ¬åœ°æ•°æ®æŒä¹…åŒ–ã€‚
                    </div>
                </div>

                <div class="module-card">
                    <div class="module-name">00_kernel/eventBus</div>
                    <div class="module-tier">äº‹ä»¶ç³»ç»Ÿ</div>
                    <div class="module-desc">
                        å…¨å±€äº‹ä»¶ç®¡ç†ã€å‘å¸ƒ-è®¢é˜…æ¨¡å¼ã€å¼‚æ­¥é€šä¿¡ã€‚
                    </div>
                </div>

                <div class="module-card">
                    <div class="module-name">00_kernel/network</div>
                    <div class="module-tier">ç½‘ç»œç®¡ç†</div>
                    <div class="module-desc">
                        ç½‘ç»œçŠ¶æ€ç›‘æµ‹ã€ç¦»çº¿æ£€æµ‹ã€é‡è¯•æœºåˆ¶ã€‚
                    </div>
                </div>

                <div class="module-card">
                    <div class="module-name">00_kernel/identity</div>
                    <div class="module-tier">èº«ä»½ç®¡ç†</div>
                    <div class="module-desc">
                        ç”¨æˆ·è®¤è¯ã€ä»¤ç‰Œç®¡ç†ã€æƒé™éªŒè¯ã€‚
                    </div>
                </div>

                <div class="module-card">
                    <div class="module-name">00_kernel/navigation</div>
                    <div class="module-tier">å¯¼èˆªç³»ç»Ÿ</div>
                    <div class="module-desc">
                        è·¯ç”±ç®¡ç†ã€é¡µé¢åˆ‡æ¢ã€å¯¼èˆªæ„å›¾ä¼ é€’ã€‚
                    </div>
                </div>

                <div class="module-card">
                    <div class="module-name">00_kernel/resilience</div>
                    <div class="module-tier">å®¹é”™æœºåˆ¶</div>
                    <div class="module-desc">
                        é‡è¯•ç­–ç•¥ã€æ–­è·¯å™¨ã€é™çº§æ–¹æ¡ˆã€‚
                    </div>
                </div>

                <div class="module-card">
                    <div class="module-name">00_kernel/telemetry</div>
                    <div class="module-tier">å¯è§‚æµ‹æ€§</div>
                    <div class="module-desc">
                        æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ã€é”™è¯¯è¿½è¸ªã€‚
                    </div>
                </div>

                <div class="module-card">
                    <div class="module-name">00_kernel/types</div>
                    <div class="module-tier">ç±»å‹ç³»ç»Ÿ</div>
                    <div class="module-desc">
                        åŸºç¡€ç±»å‹å®šä¹‰ã€TypeScript æ¥å£ã€‚
                    </div>
                </div>
            </div>
        </section>

        <!-- Domain å±‚ -->
        <section>
            <h2>ğŸ¯ Layer -1: Domain (é¢†åŸŸæ¨¡å‹å±‚)</h2>
            
            <p>ä¸šåŠ¡é¢†åŸŸçš„æ ¸å¿ƒæ¦‚å¿µå’Œæ•°æ®æ¨¡å‹ï¼Œä¸ä¾èµ–ä»»ä½•å¤–éƒ¨æ¡†æ¶ã€‚</p>

            <div class="module-grid">
                <div class="module-card">
                    <div class="module-name">01_domains/transaction</div>
                    <div class="module-tier">äº¤æ˜“é¢†åŸŸ</div>
                    <div class="module-desc">
                        <strong>æ ¸å¿ƒå®ä½“ï¼š</strong> Transaction<br>
                        <strong>ä¸»è¦åŠŸèƒ½ï¼š</strong> äº¤æ˜“æ•°æ®ç»“æ„ã€éªŒè¯è§„åˆ™ã€ä¸šåŠ¡è®¡ç®—ã€‚<br>
                        <strong>æ–‡ä»¶ï¼š</strong> types.ts, utils.ts, validators.ts
                    </div>
                </div>

                <div class="module-card">
                    <div class="module-name">01_domains/receipt</div>
                    <div class="module-tier">ç¥¨æ®é¢†åŸŸ</div>
                    <div class="module-desc">
                        <strong>æ ¸å¿ƒå®ä½“ï¼š</strong> Receipt<br>
                        <strong>ä¸»è¦åŠŸèƒ½ï¼š</strong> ç¥¨æ®æ•°æ®ç»“æ„ã€OCR ç»“æœã€å›¾ç‰‡ç®¡ç†ã€‚<br>
                        <strong>æ–‡ä»¶ï¼š</strong> types.ts, parser.ts
                    </div>
                </div>
            </div>
        </section>

        <!-- ä¸šåŠ¡æ¨¡å—å±‚ -->
        <section>
            <h2>ğŸ“¦ Layer 1-3: Business Modules (ä¸šåŠ¡æ¨¡å—å±‚)</h2>
            
            <p>å…·ä½“çš„ä¸šåŠ¡åŠŸèƒ½å®ç°ï¼Œæ¯ä¸ªæ¨¡å—éµå¾ªç»Ÿä¸€çš„åˆ†å±‚æ¶æ„ã€‚</p>

            <h3>æ¨¡å—åˆ†å±‚ç»“æ„ (ä»¥ Capture ä¸ºä¾‹)</h3>
            
            <div class="diagram">
                <div class="mermaid">
                    graph TD
                        A["ğŸ¨ Views<br/>CaptureView.tsx<br/>æ˜¾ç¤ºUIï¼Œè®¢é˜…Store"] -->|è°ƒç”¨| B["âš™ï¸ Headless<br/>useCaptureLogic<br/>ä¸šåŠ¡é€»è¾‘ç¼–æ’"]
                        B -->|æ›´æ–°| C["ğŸ—‚ï¸ Stores<br/>captureStore<br/>Zustand State"]
                        B -->|è°ƒç”¨| D["ğŸŒ‰ Adapters<br/>captureAdapter<br/>IPC/APIé€‚é…"]
                        D -->|æ‰§è¡Œ| E["âš¡ Services<br/>Tauri Native<br/>æ–‡ä»¶ç³»ç»Ÿã€æ‘„åƒå¤´"]
                        C -->|è®¢é˜…| A
                    </div>
            </div>

            <h3>æ‰€æœ‰ä¸šåŠ¡æ¨¡å—</h3>

            <div class="module-grid">
                <div class="module-card">
                    <div class="module-name">capture</div>
                    <div class="module-tier">T2 - é«˜ä¼˜å…ˆçº§</div>
                    <div class="module-desc">
                        <strong>åŠŸèƒ½ï¼š</strong> å›¾ç‰‡æ•è·ã€OCRã€æ–‡ä»¶ä¸Šä¼ <br>
                        <strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> æ‘„åƒå¤´/å›¾åº“ã€AIè¯†åˆ«<br>
                        <strong>çŠ¶æ€ç®¡ç†ï¼š</strong> captureStore, uploadStore
                    </div>
                </div>

                <div class="module-card">
                    <div class="module-name">transaction</div>
                    <div class="module-tier">T1 - æœ€é«˜ä¼˜å…ˆçº§</div>
                    <div class="module-desc">
                        <strong>åŠŸèƒ½ï¼š</strong> äº¤æ˜“ç®¡ç†ã€æ•°æ®åŒæ­¥<br>
                        <strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> CRUD æ“ä½œã€äº‘ç«¯åŒæ­¥<br>
                        <strong>çŠ¶æ€ç®¡ç†ï¼š</strong> transactionStore
                    </div>
                </div>

                <div class="module-card">
                    <div class="module-name">report</div>
                    <div class="module-tier">T1 - æœ€é«˜ä¼˜å…ˆçº§</div>
                    <div class="module-desc">
                        <strong>åŠŸèƒ½ï¼š</strong> æ•°æ®ç»Ÿè®¡ã€æŠ¥è¡¨å±•ç¤º<br>
                        <strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> æ•°æ®èšåˆã€å›¾è¡¨æ¸²æŸ“<br>
                        <strong>çŠ¶æ€ç®¡ç†ï¼š</strong> reportStore
                    </div>
                </div>

                <div class="module-card">
                    <div class="module-name">auth</div>
                    <div class="module-tier">T0 - å…³é”®ç³»ç»Ÿ</div>
                    <div class="module-desc">
                        <strong>åŠŸèƒ½ï¼š</strong> ç”¨æˆ·è®¤è¯ã€ç™»å½•æµç¨‹<br>
                        <strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> AWS Cognito é›†æˆ<br>
                        <strong>çŠ¶æ€ç®¡ç†ï¼š</strong> authStore
                    </div>
                </div>

                <div class="module-card">
                    <div class="module-name">settings</div>
                    <div class="module-tier">T2 - é«˜ä¼˜å…ˆçº§</div>
                    <div class="module-desc">
                        <strong>åŠŸèƒ½ï¼š</strong> ç”¨æˆ·åå¥½è®¾ç½®<br>
                        <strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> é…ç½®å­˜å‚¨ã€ä¸»é¢˜åˆ‡æ¢<br>
                        <strong>çŠ¶æ€ç®¡ç†ï¼š</strong> settingsStore
                    </div>
                </div>

                <div class="module-card">
                    <div class="module-name">sync</div>
                    <div class="module-tier">T1 - æœ€é«˜ä¼˜å…ˆçº§</div>
                    <div class="module-desc">
                        <strong>åŠŸèƒ½ï¼š</strong> æ•°æ®åŒæ­¥åè°ƒ<br>
                        <strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> å†²çªè§£å†³ã€å¢é‡åŒæ­¥<br>
                        <strong>çŠ¶æ€ç®¡ç†ï¼š</strong> syncStore
                    </div>
                </div>

                <div class="module-card">
                    <div class="module-name">debug</div>
                    <div class="module-tier">å¼€å‘å·¥å…·</div>
                    <div class="module-desc">
                        <strong>åŠŸèƒ½ï¼š</strong> è°ƒè¯•å·¥å…·ã€æ•°æ®æŸ¥çœ‹<br>
                        <strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> Mock æ•°æ®ã€æ—¥å¿—æŸ¥çœ‹<br>
                        <strong>ä»…å¼€å‘æ¨¡å¼ï¼š</strong> ç”Ÿäº§ç¯å¢ƒä¸å¯ç”¨
                    </div>
                </div>

                <div class="module-card">
                    <div class="module-name">dashboard</div>
                    <div class="module-tier">T1 - æœ€é«˜ä¼˜å…ˆçº§</div>
                    <div class="module-desc">
                        <strong>åŠŸèƒ½ï¼š</strong> ä¸»ä»ªè¡¨æ¿ã€æ•°æ®æ¦‚è§ˆ<br>
                        <strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> æ•°æ®èšåˆå±•ç¤º<br>
                        <strong>é›†æˆï¼š</strong> report, transaction æ¨¡å—
                    </div>
                </div>
            </div>
        </section>

        <!-- æ¨¡å—å†…éƒ¨ç»“æ„ -->
        <section>
            <h2>ğŸ” Module Internal Structure (æ¨¡å—å†…éƒ¨ç»“æ„)</h2>
            
            <p>æ¯ä¸ªä¸šåŠ¡æ¨¡å—éµå¾ªç»Ÿä¸€çš„åˆ†å±‚æ¶æ„ï¼š</p>

            <div class="diagram">
                <div class="mermaid">
                    graph TB
                        subgraph "Views Layer"
                            V1["CaptureView.tsx"]
                            V2["EditModal.tsx"]
                        end
                        
                        subgraph "Headless Layer (TS Logic)"
                            H1["useCaptureLogic()"]
                            H2["useUploadLogic()"]
                        end
                        
                        subgraph "Stores Layer (State)"
                            S1["captureStore"]
                            S2["uploadStore"]
                        end
                        
                        subgraph "Services Layer"
                            SV1["captureService"]
                            SV2["uploadService"]
                        end
                        
                        subgraph "Adapters Layer"
                            A1["captureAdapter"]
                            A2["uploadAdapter"]
                        end
                        
                        subgraph "Tauri/AWS Layer"
                            T1["Tauri IPC<br/>invoke"]
                            T2["AWS SDK<br/>calls"]
                        end
                        
                        V1 -->|ä½¿ç”¨Hook| H1
                        V2 -->|ä½¿ç”¨Hook| H2
                        H1 -->|è®¢é˜…| S1
                        H2 -->|è®¢é˜…| S2
                        H1 -->|è°ƒç”¨| SV1
                        H2 -->|è°ƒç”¨| SV2
                        SV1 -->|è°ƒç”¨| A1
                        SV2 -->|è°ƒç”¨| A2
                        A1 -->|æ‰§è¡Œ| T1
                        A2 -->|æ‰§è¡Œ| T2
                </div>
            </div>

            <h3>æ¨¡å—ç›®å½•ç»“æ„ç¤ºä¾‹</h3>

            <table>
                <thead>
                    <tr>
                        <th>ç›®å½•</th>
                        <th>æ–‡ä»¶</th>
                        <th>è´£ä»»</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>views/</code></td>
                        <td>CaptureView.tsx, EditModal.tsx</td>
                        <td>UI ç»„ä»¶ï¼Œè®¢é˜… storeï¼Œè°ƒç”¨ hook</td>
                    </tr>
                    <tr>
                        <td><code>headless/</code></td>
                        <td>useCaptureLogic.ts, useUploadLogic.ts</td>
                        <td>React hooksï¼Œä¸šåŠ¡é€»è¾‘ç¼–æ’</td>
                    </tr>
                    <tr>
                        <td><code>hooks/</code></td>
                        <td>useQuotaState.ts, useImageUrl.ts</td>
                        <td>UI ç›¸å…³çš„ hooks (å†…éƒ¨çŠ¶æ€)</td>
                    </tr>
                    <tr>
                        <td><code>services/</code></td>
                        <td>captureService.ts, uploadService.ts</td>
                        <td>çº¯ TS ä¸šåŠ¡é€»è¾‘ï¼Œç‹¬ç«‹äº React</td>
                    </tr>
                    <tr>
                        <td><code>stores/</code></td>
                        <td>captureStore.ts, uploadStore.ts</td>
                        <td>Zustand storeï¼Œå…¨å±€çŠ¶æ€</td>
                    </tr>
                    <tr>
                        <td><code>adapters/</code></td>
                        <td>captureAdapter.ts, uploadAdapter.ts</td>
                        <td>Tauri IPCã€AWS API å°è£…</td>
                    </tr>
                    <tr>
                        <td><code>types.ts</code></td>
                        <td>TypeScript æ¥å£å®šä¹‰</td>
                        <td>æ¨¡å—å†…çš„ç±»å‹å£°æ˜</td>
                    </tr>
                    <tr>
                        <td><code>index.ts</code></td>
                        <td>å¯¼å‡ºå…¬å…±æ¥å£</td>
                        <td>æ¨¡å—çš„å…¬å…± API</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- æ•°æ®æµç¤ºä¾‹ -->
        <section>
            <h2>ğŸ”„ Data Flow Example (æ•°æ®æµç¤ºä¾‹)</h2>
            
            <h3>ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡å®Œæ•´æµç¨‹</h3>

            <div class="data-flow">
                <div class="flow-step">
                    <div class="flow-step-num">1</div>
                    <div class="flow-step-content">
                        <div class="flow-step-title">ç”¨æˆ·ç‚¹å‡»ä¸Šä¼ æŒ‰é’®</div>
                        <div class="flow-step-desc">CaptureView.tsx å“åº”ç”¨æˆ·ç‚¹å‡»äº‹ä»¶ï¼Œè°ƒç”¨ useCaptureLogic æš´éœ²çš„æ–¹æ³•</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="flow-step-num">2</div>
                    <div class="flow-step-content">
                        <div class="flow-step-title">Headless å±‚ç¼–æ’æµç¨‹</div>
                        <div class="flow-step-desc">useCaptureLogic è°ƒç”¨ captureService.upload() å‘èµ·ä¸šåŠ¡æµç¨‹</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="flow-step-num">3</div>
                    <div class="flow-step-content">
                        <div class="flow-step-title">Service å±‚æ‰§è¡Œé€»è¾‘</div>
                        <div class="flow-step-desc">captureService éªŒè¯æ•°æ®ï¼Œæ›´æ–° uploadStore ä¸º "uploading"ï¼Œè°ƒç”¨ uploadAdapter</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="flow-step-num">4</div>
                    <div class="flow-step-content">
                        <div class="flow-step-title">Adapter å±‚è½¬æ¢è¯·æ±‚</div>
                        <div class="flow-step-desc">uploadAdapter å°†ä¸šåŠ¡è¯·æ±‚è½¬æ¢ä¸º Tauri IPC è°ƒç”¨æˆ– AWS SDK è°ƒç”¨</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="flow-step-num">5</div>
                    <div class="flow-step-content">
                        <div class="flow-step-title">æ‰§è¡Œå±‚æ‰§è¡Œæ“ä½œ</div>
                        <div class="flow-step-desc">Tauri åç«¯å¤„ç†æ–‡ä»¶ï¼Œä¸Šä¼ åˆ° AWS S3ï¼Œè¿”å›ç»“æœ</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="flow-step-num">6</div>
                    <div class="flow-step-content">
                        <div class="flow-step-title">Service æ›´æ–°çŠ¶æ€</div>
                        <div class="flow-step-desc">captureService æ¥æ”¶ç»“æœï¼Œæ›´æ–° uploadStore ä¸º "completed" æˆ– "failed"</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="flow-step-num">7</div>
                    <div class="flow-step-content">
                        <div class="flow-step-title">React è§†å›¾æ›´æ–°</div>
                        <div class="flow-step-desc">CaptureView è®¢é˜… uploadStoreï¼Œè‡ªåŠ¨é‡æ–°æ¸²æŸ“æ˜¾ç¤ºä¸Šä¼ ç»“æœ</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ä¾èµ–å…³ç³» -->
        <section>
            <h2>ğŸ”— Dependency Graph (ä¾èµ–å…³ç³»å›¾)</h2>
            
            <div class="diagram">
                <div class="mermaid">
                    graph LR
                        A["Kernel<br/>00_kernel"] -->|åŸºç¡€| B["Domain<br/>01_domains"]
                        A -->|åŸºç¡€| C["Modules<br/>02_modules"]
                        B -->|æ¨¡å‹| C
                        
                        C1["auth"]
                        C2["dashboard"]
                        C3["capture"]
                        C4["transaction"]
                        C5["report"]
                        C6["sync"]
                        C7["settings"]
                        
                        C1 -->|èº«ä»½éªŒè¯| C4
                        C1 -->|èº«ä»½éªŒè¯| C6
                        C3 -->|ç”Ÿæˆ| C4
                        C4 -->|æ•°æ®| C5
                        C4 -->|åŒæ­¥| C6
                        C6 -->|æ›´æ–°| C4
                        C5 -->|å±•ç¤º| C2
                        C7 -->|é…ç½®| C3
                        C7 -->|é…ç½®| C4
                </div>
            </div>
        </section>

        <!-- å…³é”®è®¾è®¡åŸåˆ™ -->
        <section>
            <h2>âœ¨ Key Design Principles (å…³é”®è®¾è®¡åŸåˆ™)</h2>
            
            <table>
                <thead>
                    <tr>
                        <th>åŸåˆ™</th>
                        <th>è¯´æ˜</th>
                        <th>å¥½å¤„</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>å•å‘æ•°æ®æµ</strong></td>
                        <td>æ•°æ®ä» Service æµå‘ Storeï¼Œä» Store æµå‘ View</td>
                        <td>æ˜“äºè¿½è¸ªå’Œè°ƒè¯•ï¼Œé˜²æ­¢å¾ªç¯ä¾èµ–</td>
                    </tr>
                    <tr>
                        <td><strong>å…³æ³¨ç‚¹åˆ†ç¦»</strong></td>
                        <td>View ä¸å…³å¿ƒä¸šåŠ¡é€»è¾‘ï¼ŒService ä¸å…³å¿ƒ UI</td>
                        <td>ä»£ç å¤ç”¨æ€§é«˜ï¼Œæµ‹è¯•å®¹æ˜“</td>
                    </tr>
                    <tr>
                        <td><strong>æœåŠ¡é©±åŠ¨</strong></td>
                        <td>Service æ˜¯ä¸šåŠ¡é€»è¾‘çš„å”¯ä¸€å…¥å£</td>
                        <td>ä¸šåŠ¡é€»è¾‘é›†ä¸­ï¼Œä¾¿äºç»´æŠ¤</td>
                    </tr>
                    <tr>
                        <td><strong>æœ¬åœ°ä¼˜å…ˆ</strong></td>
                        <td>ä¼˜å…ˆä½¿ç”¨æœ¬åœ°å­˜å‚¨ï¼ŒåŒæ­¥åˆ°äº‘ç«¯</td>
                        <td>ç¦»çº¿å¯ç”¨ï¼Œç”¨æˆ·ä½“éªŒå¥½</td>
                    </tr>
                    <tr>
                        <td><strong>å…¨å±€ç›‘å¬</strong></td>
                        <td>Service åœ¨å¯åŠ¨æ—¶æ³¨å†Œä¸€æ¬¡å…¨å±€ç›‘å¬</td>
                        <td>ç›‘å¬ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äº Reactï¼Œå¯é æ€§é«˜</td>
                    </tr>
                    <tr>
                        <td><strong>ç±»å‹å®‰å…¨</strong></td>
                        <td>å……åˆ†åˆ©ç”¨ TypeScriptï¼Œçº¦æŸè¾¹ç•Œ</td>
                        <td>ç¼–è¯‘æ—¶å‘ç°é”™è¯¯ï¼Œå‡å°‘è¿è¡Œæ—¶ bug</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- æ¨¡å—ä¼˜å…ˆçº§çŸ©é˜µ -->
        <section>
            <h2>ğŸ“ˆ Module Priority Matrix (æ¨¡å—ä¼˜å…ˆçº§çŸ©é˜µ)</h2>
            
            <div class="diagram">
                <div class="mermaid">
                    quadrantChart
                        title æ¨¡å—ä¼˜å…ˆçº§å’Œå¤æ‚åº¦
                        x-axis å¤æ‚åº¦ --> ç®€å•åº¦
                        y-axis ä¼˜å…ˆçº§ä½ --> ä¼˜å…ˆçº§é«˜
                        
                        transaction: 0.8, 0.9
                        auth: 0.7, 0.85
                        sync: 0.85, 0.8
                        dashboard: 0.6, 0.75
                        capture: 0.75, 0.7
                        report: 0.65, 0.7
                        settings: 0.3, 0.4
                        debug: 0.4, 0.2
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>ä¼˜å…ˆçº§</th>
                        <th>æ¨¡å—</th>
                        <th>ç†ç”±</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong style="color: #e74c3c;">T0 (å…³é”®)</strong></td>
                        <td>auth, transaction, sync</td>
                        <td>åº”ç”¨æ ¸å¿ƒï¼Œå¿…é¡»ç¨³å®šå¯é </td>
                    </tr>
                    <tr>
                        <td><strong style="color: #f39c12;">T1 (é«˜)</strong></td>
                        <td>dashboard, report, capture</td>
                        <td>ç”¨æˆ·æ ¸å¿ƒåŠŸèƒ½ï¼Œå½±å“ä½“éªŒ</td>
                    </tr>
                    <tr>
                        <td><strong style="color: #27ae60;">T2 (ä¸­)</strong></td>
                        <td>settings, debug</td>
                        <td>å¢å¼ºåŠŸèƒ½æˆ–å¼€å‘å·¥å…·</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- å¿«é€Ÿå‚è€ƒ -->
        <section>
            <h2>ğŸ“š Quick Reference Guide (å¿«é€Ÿå‚è€ƒ)</h2>
            
            <h3>å¦‚ä½•æ·»åŠ æ–°åŠŸèƒ½ï¼Ÿ</h3>
            <ol>
                <li><strong>å®šä¹‰æ•°æ®æ¨¡å‹</strong> â†’ åœ¨ 01_domains ä¸­å®šä¹‰ types.ts</li>
                <li><strong>åˆ›å»ºä¸šåŠ¡é€»è¾‘</strong> â†’ åœ¨æ–° module ä¸­åˆ›å»º service å’Œ store</li>
                <li><strong>ç¼–å†™é€‚é…å™¨</strong> â†’ è¿æ¥ Tauri IPC å’Œ AWS API</li>
                <li><strong>æ„å»ºç”¨æˆ·ç•Œé¢</strong> â†’ åœ¨ views ä¸­åˆ›å»º React ç»„ä»¶</li>
                <li><strong>ç¼–å†™æµ‹è¯•</strong> â†’ ä¸º service å’Œ headless å±‚ç¼–å†™å•å…ƒæµ‹è¯•</li>
            </ol>

            <h3>è°ƒè¯•æŠ€å·§</h3>
            <ul>
                <li>ä½¿ç”¨ Debug æ¨¡å—æŸ¥çœ‹å®æ—¶æ—¥å¿—</li>
                <li>æŸ¥çœ‹ Zustand DevTools è§‚å¯ŸçŠ¶æ€å˜åŒ–</li>
                <li>åœ¨ Tauri åç«¯æ£€æŸ¥ console è¾“å‡º</li>
                <li>ä½¿ç”¨ Mock æ¨¡å¼æ¨¡æ‹Ÿç½‘ç»œçŠ¶æ€</li>
            </ul>

            <h3>æ€§èƒ½ä¼˜åŒ–ç‚¹</h3>
            <ul>
                <li><strong>State è®¢é˜…</strong>ï¼šä½¿ç”¨ selector åªè®¢é˜…éœ€è¦çš„çŠ¶æ€éƒ¨åˆ†</li>
                <li><strong>äº‹ä»¶èŠ‚æµ</strong>ï¼šå¯¹é«˜é¢‘äº‹ä»¶è¿›è¡ŒèŠ‚æµå¤„ç†</li>
                <li><strong>å¼‚æ­¥æ“ä½œ</strong>ï¼šä½¿ç”¨ Promise è€Œé async/await ä»¥æé«˜å“åº”æ€§</li>
                <li><strong>ç¼“å­˜ç­–ç•¥</strong>ï¼šåœ¨ Service å±‚å®ç°æ™ºèƒ½ç¼“å­˜</li>
            </ul>
        </section>

        <!-- Footer -->
        <footer>
            <p>Yorutsuke v2 Architecture Documentation | Last Updated: 2026-01-12</p>
            <p>æ›´å¤šè¯¦æƒ…è¯·å‚è€ƒ <a href="../architecture/README.md">docs/architecture</a> ç›®å½•</p>
        </footer>
    </div>

    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</body>
</html>