# MVP1 - 纯本地 (Local Only)

> **目标**: 验证本地捕获流程，无需任何后端

### 功能范围

| 功能 | 说明 | 状态 |
|------|------|------|
| 拖放图片 | Drag & drop 到应用窗口 | [ ] |
| 点击选择 | 点击 Drop Zone 打开文件选择器 | [ ] |
| 粘贴图片 | Ctrl+V / Cmd+V 粘贴剪贴板图片 | [ ] |
| 图片压缩 | JPEG/PNG → WebP (<500KB) | [ ] |
| 队列显示 | 显示 pending/compressed 状态 | [ ] |
| 本地存储 | SQLite 存储图片元数据 | [ ] |
| 重复检测 | MD5 去重 | [ ] |
| 缩略图 | 显示压缩后预览 | [ ] |

### 测试场景

从 [FRONTEND.md](../tests/FRONTEND.md) 选取：

#### 1.1 Happy Path
| ID | 场景 | 预期 |
|----|------|------|
| SC-001 | 单张图片拖放 | 压缩成功，状态 compressed |
| SC-002 | 多张图片拖放 | 顺序处理 |
| SC-003 | 大图 (>5MB) | 压缩到 <500KB |
| SC-004 | 小图 (<100KB) | 仍压缩为 WebP |
| SC-005 | 点击选择单张图片 | 文件选择器打开，选择后处理 |
| SC-006 | 点击选择多张图片 | 支持多选，顺序处理 |
| SC-007 | 粘贴截图 (Cmd+V) | 剪贴板图片处理 |
| SC-008 | 粘贴单张图片文件 | 文件数据处理 |
| SC-009 | 粘贴多张图片文件 | 顺序处理所有文件 |

#### 1.2 File Validation
| ID | 场景 | 预期 |
|----|------|------|
| SC-010 | 有效格式 (JPG/PNG/WebP) | 全部接受 |
| SC-011 | 无效格式 (.txt/.pdf) | 拒绝并提示 |
| SC-012 | 损坏图片 | 错误: "Failed to open image" |
| SC-013 | 空文件 | 优雅处理错误 |

#### 1.3 Duplicate Detection
| ID | 场景 | 预期 |
|----|------|------|
| SC-020 | 同文件两次 | 第二次检测为重复 |
| SC-021 | 相同内容不同名 | MD5 检测为重复 |
| SC-022 | 相似但不同 | 两张都处理 (MD5 不同) |
| SC-023 | 快速双击 | 只处理一次 |

#### 6.1 App Lifecycle - Startup
| ID | 场景 | 预期 |
|----|------|------|
| SC-500 | 全新安装 | DB 初始化，guest 模式 |
| SC-501 | 恢复会话 | 关闭后重开，队列恢复 |
| SC-502 | 恢复 pending | 崩溃后重开，pending 重新处理 |
| SC-503 | 恢复 uploading | 崩溃后重开，重置为 compressed |

#### 8. Data Integrity
| ID | 场景 | 预期 |
|----|------|------|
| SC-700 | ImageId 唯一 | 拖放 100 张，ID 都唯一 |
| SC-701 | TraceId 追踪 | 拖放→压缩→日志，traceId 一致 |
| SC-702 | IntentId 幂等 | 上传→重试，intentId 不变 |
| SC-703 | MD5 准确 | 同图两次，MD5 相同 |
| SC-710 | 队列-DB 同步 | 拖放→压缩→检查 DB，数据一致 |
| SC-711 | 状态转换 | 遵循允许的状态转换路径 |
| SC-712 | 无孤儿记录 | 处理多张图片，DB 无孤儿 |

#### 14. Performance (NFR)
| ID | 场景 | 预期 |
|----|------|------|
| SC-1400 | App bundle 大小 | < 5MB |
| SC-1410 | 小图压缩 (<1MB) | < 1 秒 |
| SC-1411 | 中图压缩 (1-5MB) | < 2 秒 |
| SC-1412 | 大图压缩 (>5MB) | < 3 秒 |
| SC-1420 | 冷启动 | < 3 秒 |

### 环境配置

```bash
# Mock 模式 - 跳过所有网络请求
cd app
cp .env.mock .env.local
npm run tauri dev
```

### 验收标准

- [ ] 拖放 10 张不同图片，全部压缩成功
- [ ] 拖放重复图片，正确检测并跳过
- [ ] 重启应用后，队列状态从 SQLite 恢复
- [ ] 无网络环境下正常工作
- [ ] 所有 SC-001~023 通过
- [ ] 所有 SC-500~503 通过
- [ ] 所有 SC-700~712 通过
- [ ] 所有 SC-1400, SC-1410~1412, SC-1420 通过 (Performance)

### 依赖

- 无后端依赖
- Mock 模式启用
